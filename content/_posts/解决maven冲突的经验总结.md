---
title: "解决 Maven 冲突的经验总结"
date: 2020-02-03T12:47:48+08:00
draft: false
---

包管理工作的本质就是告诉 JVM 它需要的第三方的类库在哪，并且当遇到包冲突的时候，来解决它。Maven 就是其中的一个包管理工具。

<!--more-->

## Maven 处理包冲突的默认规则

在遇到包冲突的时候，包管理工具都有自己的一套规则，Maven 也有，有时候能解决，这时候我们是无感知的；但是有时候解决不了，就会在编译或者运行的时候抛出错误。

为了更准确、更快的找出包冲突的原因，我们需要先了解 Maven 处理包冲突的机制，从而才能进一步分析是什么问题导致了包冲突。

首先，对 Maven 来说，它决不允许传给 JVM 的 ClassPath 出现同名不同版本的 jar 包，如果出现了， Maven 按照以下两个规则来处理：

1. 谁离得近选择谁，比如 `B->C vs D->A->C` ，这时候如果用到 C 包的地方都会选择 B 后面的 C。
2. 如果离得同样近，谁先被找到选择谁。比如 `B -> C vs D -> C` ，我们会选择 B 后面的 C。

总之，「最近」的胜出。

通常来说，我们依据上面两条规则，再加上报错信息，耐心的找，总能找出是哪个包导致了错误。当我们找到了错误怎么去解决呢？

## 手动解决包冲突的方法

假设我们已经找到了问题包是哪个，假设这个包名叫做 A。

### 方法一

既然「最近」的会胜出，那我们把正确的包 A 放在 pom 文件的最外层就好了，那每次都会查找到这个正确的 A。

### 方法二

我们还可以使用 Maven 的 `exclusion` 语法。

假设 B 包里引用了 A ，这是我们不想要的，我们可以使用如下语法，不让 B 使用它自己引用的 A。

```
<dependency>
  // 包 B
  <groupId>xxx<groupId>
  .....

  <exclusion>
    // 包 A
  </exclusion>
</dependency>
```

### 方法三

如果你在使用 Idea，可以借助 Maven helper 这个插件，这里的具体操作就不演示了。

以上就是 Maven 包冲突的一些常见的解决方案的总结，希望能帮到你。
